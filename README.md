# IP & Licensing Reconciliation Module (ILRM)

**Protocol Version:** 1.5
**Status:** Testnet Ready
**License:** Apache-2.0

---

## Overview

The IP & Licensing Reconciliation Module (ILRM) is the core component of the **NatLangChain** protocol - a non-adjudicative coordination system for compressing, de-escalating, and economically resolving intellectual property and licensing disputes.

> **NatLangChain doesn't govern people - it governs the price of conflict.**

ILRM does not adjudicate rights or render binding legal judgments. Instead, it provides a time-bounded, incentive-aligned coordination mechanism that:

- Encourages rapid settlement through economic incentives
- Penalizes prolonged disagreement via stake burns
- Preserves asset continuity through fallback licensing
- Produces structured data for future contract-risk analysis

---

## Important Notice

This project includes a `LICENSE_APPENDIX.md` that clarifies intended use and boundaries. The protocol and its modules are **non-adjudicative coordination tools**, not courts, judges, or legally binding arbitration systems. Any proposals, reconciliations, or license adjustments generated by the system are **non-authoritative and non-binding**, and require explicit participant acceptance.

---

## Architecture

```
+-----------------------------------------------------------------------------+
|                          NatLangChain Protocol v1.5                          |
+-----------------------------------------------------------------------------+
|                                                                              |
|   CORE DISPUTE RESOLUTION                                                    |
|   +------------------+    +------------------+    +--------------------+     |
|   |      ILRM        |<---|     Oracle       |    |     Treasury       |     |
|   | (Dispute Engine) |    | (LLM Bridge)     |    | (Subsidies/Burns)  |     |
|   +--------+---------+    +------------------+    +--------------------+     |
|            |                                                                 |
|            v                                                                 |
|   +------------------+                                                       |
|   |  AssetRegistry   |                                                       |
|   | (IP Management)  |                                                       |
|   +------------------+                                                       |
|                                                                              |
|   IDENTITY & PRIVACY                                                         |
|   +------------------+    +------------------+    +--------------------+     |
|   | IdentityVerifier |    |  FIDOVerifier    |    |   DIDRegistry      |     |
|   | (ZK Proofs)      |    | (Hardware Auth)  |    | (Decentralized ID) |     |
|   +------------------+    +------------------+    +--------------------+     |
|                                                                              |
|   COMPLIANCE & GOVERNANCE                                                    |
|   +------------------+    +------------------+    +--------------------+     |
|   |ComplianceEscrow  |    |ComplianceCouncil |    |GovernanceTimelock  |     |
|   | (Viewing Keys)   |    | (BLS Threshold)  |    | (Multi-Sig Admin)  |     |
|   +------------------+    +------------------+    +--------------------+     |
|                                                                              |
|   PRIVACY & SCALING                                                          |
|   +------------------+    +------------------+    +--------------------+     |
|   |   BatchQueue     |    |   L3Bridge       |    |  L3StateVerifier   |     |
|   | (Tx Batching)    |    | (L3 Rollup)      |    | (Merkle Proofs)    |     |
|   +------------------+    +------------------+    +--------------------+     |
|                                                                              |
+-----------------------------------------------------------------------------+
```

---

## Core Contracts (16 Total)

| Contract | Purpose | Key Features |
|----------|---------|--------------|
| **ILRM.sol** | Core dispute resolution engine | Breach disputes, voluntary requests, ZK mode, FIDO auth, DID integration |
| **MultiPartyILRM.sol** | Multi-party variant (3+ parties) | Configurable quorum types, proportional burns |
| **Oracle.sol** | LLM proposal bridge | EIP-712 signatures, chain fork detection, multi-oracle support |
| **Treasury.sol** | Protocol fund management | Dynamic caps, tiered subsidies, anti-Sybil protections |
| **AssetRegistry.sol** | IP asset & license tracking | Freeze/unfreeze, fallback licenses, DoS protection |
| **ComplianceEscrow.sol** | Viewing key threshold cryptography | Shamir's Secret Sharing, m-of-n voting |
| **ComplianceCouncil.sol** | Legal compliance with BLS signatures | Execution modes, warrant requests, appeals |
| **IdentityVerifier.sol** | ZK proof verification (Groth16) | BN254 curve, nonce management, replay protection |
| **FIDOVerifier.sol** | Hardware-backed authentication | P-256/WebAuthn, RIP-7212 precompile support |
| **DIDRegistry.sol** | Decentralized identity management | ERC-725 compatible, Verifiable Credentials, Sybil scores |
| **GovernanceTimelock.sol** | Multi-sig governance with delays | Emergency actions, contract registry, Ownable2Step |
| **BatchQueue.sol** | Privacy-preserving batch transactions | Fisher-Yates shuffle, Chainlink Automation |
| **DummyTransactionGenerator.sol** | Transaction pattern obfuscation | Probability-based generation, VRF compatible |
| **L3Bridge.sol** | Layer 3 rollup bridge | State commitments, fraud proofs, batch settlements |
| **L3DisputeBatcher.sol** | Batch dispute handling for L3 | Auto-trigger, authorized submitters |
| **L3StateVerifier.sol** | Merkle proof verification | Sparse tree support, batch verification |

---

## Key Features

### Dispute Resolution
- **Dual Initiation Model**: Breach disputes (staked) and voluntary requests (burn-only)
- **Symmetric Stakes**: Both parties stake equally, face equal risk
- **Counter-Proposals**: Max 3, with exponentially increasing fees
- **Timeout Resolution**: 50% burn, fallback license application
- **Cooldown Enforcement**: 30-day wait between disputes with same counterparty
- **Harassment Tracking**: Escalating stakes for repeat frivolous initiators

### Privacy & Identity
- **ZK Identity Mode**: Prove dispute participation without revealing address
- **FIDO2/WebAuthn**: Hardware-backed authentication for acceptances
- **Decentralized Identity (DID)**: Sybil-resistant participation via credentials
- **Viewing Keys**: Selective de-anonymization with threshold voting
- **Batch Transactions**: Privacy-preserving transaction batching

### Compliance & Governance
- **Compliance Council**: BLS threshold signatures for legal warrants
- **Execution Modes**: DISABLED, STRICT_ONCHAIN, HYBRID_ATTESTED
- **Governance Timelock**: Multi-sig with configurable delays
- **Emergency Pause**: System-wide pause capability

### Scaling
- **L3 Bridge**: App-specific rollup with optimistic state commitments
- **Fraud Proofs**: 7-day challenge period with challenger bonds
- **Batch Settlements**: Up to 100 disputes per batch

---

## Protocol Safety Invariants

The protocol guarantees 10 core safety properties:

1. **No Unilateral Cost Imposition** - Initiator must stake first
2. **Silence Is Always Free** - Ignoring voluntary requests costs nothing
3. **Initiator Risk Precedence** - Initiator exposed before counterparty
4. **Bounded Griefing** - Max 3 counters, exponential fees
5. **Harassment Is Net-Negative** - Escalating costs for repeat initiators
6. **Mutuality or Exit** - Timeout guarantees resolution
7. **Outcome Neutrality** - No winners/losers declared
8. **Economic Symmetry** - Matched stakes, identical timers
9. **Predictable Cost Surfaces** - All fees/burns explicit upfront
10. **Protocol Non-Sovereignty** - No legal authority claims

---

## Security

### Audit Status

All identified vulnerabilities have been fixed:

| Severity | Count | Status |
|----------|-------|--------|
| Critical | 3 | All Fixed |
| High | 4 | All Fixed |
| Medium | 5 | All Fixed |
| Low | 3 | All Fixed |

See `docs/SECURITY_AUDIT_REPORT.md` for full details.

### Security Patterns
- ReentrancyGuard on all state-changing functions
- Pausable for emergency stops
- Ownable2Step for safe ownership transfers
- SafeERC20 for token transfers
- CEI pattern (checks-effects-interactions)
- Input validation on critical parameters

---

## Constants & Defaults

| Constant | Value | Description |
|----------|-------|-------------|
| STAKE_WINDOW | 3 days | Time for counterparty to match stake |
| RESOLUTION_TIMEOUT | 7 days | Maximum dispute duration |
| BURN_PERCENTAGE | 50% | Portion burned on timeout |
| MAX_COUNTERS | 3 | Maximum counter-proposals |
| COUNTER_FEE_BASE | 0.01 ETH | Initial counter fee (exponential) |
| COOLDOWN_PERIOD | 30 days | Minimum between same-party disputes |
| HARASSMENT_THRESHOLD | 50 | Score threshold for subsidy blocking |
| MAX_ASSETS_PER_OWNER | 100 | DoS protection limit |

---

## Installation

### Prerequisites
- [Foundry](https://getfoundry.sh/) for Solidity development
- [Node.js](https://nodejs.org/) v18+ for TypeScript SDK
- Solidity ^0.8.20

### Setup

```bash
# Clone repository
git clone https://github.com/your-org/ILR-module.git
cd ILR-module

# Install Foundry dependencies
forge install

# Install Node dependencies
npm install

# Compile contracts
forge build

# Run tests
forge test
```

---

## Testing

```bash
# Run all tests
forge test

# Run with verbosity
forge test -vvv

# Run specific test file
forge test --match-contract ILRM -vvv

# Run with gas reporting
forge test --gas-report

# Run fuzz tests with high iterations
forge test --fuzz-runs 10000
```

### Test Suites

| Test File | Coverage |
|-----------|----------|
| `ILRM.t.sol` | Core dispute lifecycle |
| `E2ESimulation.t.sol` | 100+ end-to-end scenarios |
| `CrossContractIntegration.t.sol` | Inter-contract interactions |
| `SecurityExploits.t.sol` | Vulnerability testing |
| `StateMachinePermutations.t.sol` | State transition coverage |
| `DeadEndDetection.t.sol` | Deadlock detection |
| `NoDeadEndsVerification.t.sol` | Deadlock-free verification |

---

## Deployment

### Supported Networks
- Ethereum Mainnet
- Optimism L2
- Arbitrum L2
- Sepolia Testnet

### Contract Addresses (Testnet)

| Contract | Network | Address |
|----------|---------|---------|
| ILRM | Optimism Sepolia | TBD |
| Treasury | Optimism Sepolia | TBD |
| Oracle | Optimism Sepolia | TBD |
| AssetRegistry | Optimism Sepolia | TBD |

---

## State Transition Diagram

```
+-------------+
|   Inactive  |
+-------------+
       |
       v
+-------------+  Initiate (Stake S, Evidence Hash, Fallback)
|  Initiated  |<---------------- Counterparty Stakes within T_stake?
+-------------+                  Yes: Proceed to Active
       |                         No: DefaultLicenseApplied -> Resolved
       v
+-------------+
|    Active   |
+-------------+
| Proposal Gen|
| (LLM/Oracle)|
+-------------+
       |
       +--> Mutual Acceptance? Yes: AcceptedProposal -> Resolved (Stakes Returned)
       |
       +--> Counter? (Fee Burned, Window Extended, Max 3) -> Back to Proposal Gen
       |
       v
Timeout (T_resolution)? -> TimeoutWithBurn (50% Burn) -> DefaultLicenseApplied -> Resolved
```

---

## Documentation

| Document | Description |
|----------|-------------|
| `SPEC.md` | Complete protocol specification v1.5 |
| `Protocol-Safety-Invariants.md` | Formal safety guarantees |
| `Treasury.md` | Treasury blueprint and mechanics |
| `Updated-Mechanics.md` | Detailed ILRM mechanics |
| `docs/SECURITY_AUDIT_REPORT.md` | Security audit findings |
| `docs/SIMULATION_RESULTS.md` | E2E simulation results |
| `LICENSE_APPENDIX.md` | Usage clarifications |

---

## Roadmap

| Phase | Status | Key Features |
|-------|--------|--------------|
| **Phase 1** (2026) | In Progress | Core stabilization, L2 deployment, economic validation |
| **Phase 2** (2026-2027) | Planned | License Entropy Oracle, multi-party, explainability |
| **Phase 3** (2028-2029) | Planned | Clause hardening, ZK evidence, L3 scaling |
| **Phase 4** (2030+) | Planned | Adaptive workflows, real-world bridging, cross-chain |

---

## Contributing

Please read `CONTRIBUTING.md` for contribution guidelines and `CODE_OF_CONDUCT.md` for community standards.

---

## License

This project is licensed under Apache-2.0. See `LICENSE` and `LICENSE_APPENDIX.md` for details.

---

## Links

- [Protocol Specification](./SPEC.md)
- [Security Audit Report](./docs/SECURITY_AUDIT_REPORT.md)
- [Safety Invariants](./Protocol-Safety-Invariants.md)
- [Simulation Results](./docs/SIMULATION_RESULTS.md)
